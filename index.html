<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Uber Style Map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

<!-- Mapbox GL JS v1 (compatível com qualquer token) -->
<link href="https://api.mapbox.com/mapbox-gl-js/v1.13.2/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.13.2/mapbox-gl.js"></script>

<style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100vh; }

    /* Estilo Uber: Popup preto e branco */
    .uber-popup {
        background: white;
        padding: 10px 14px;
        border-radius: 8px;
        font-family: sans-serif;
        font-size: 13px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    }

    .uber-time {
        font-weight: bold;
        color: black;
        font-size: 14px;
    }

    .uber-address {
        margin-top: 4px;
        color: #444;
    }

    /* Remover caixa default do Mapbox */
    .mapboxgl-popup-content {
        background: transparent !important;
        box-shadow: none !important;
        padding: 0 !important;
    }

    .mapboxgl-popup-tip {
        display: none !important;
    }
</style>
</head>

<body>
<div id="map"></div>

<script>

// ===========================================
// CONFIGURAÇÕES INICIAIS
// ===========================================

mapboxgl.accessToken = 'pk.eyJ1IjoidmVsbG9kcml2ZXIiLCJhIjoiY21iMGc2azhiMHcyNDJrcTJrN3F3dnp1bSJ9.A6iU7GA4IixnaTbhJPe9hQ';

// Coordenadas de teste → (você pode substituir por query params)
const origin = [-51.616314, -28.759461];
const dest   = [-51.604392, -28.777384];

// Estilo parecido com Uber: LIGHT
const uberStyle = "mapbox://styles/mapbox/light-v10";

// Criar mapa no centro da origem
const map = new mapboxgl.Map({
    container: 'map',
    style: uberStyle,
    center: origin,
    zoom: 13
});

// ===========================================
// FUNÇÃO PARA DESENHAR ROTA (Uber Blue)
// ===========================================

async function drawRoute() {

    const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${origin[0]},${origin[1]};${dest[0]},${dest[1]}?geometries=geojson&access_token=${mapboxgl.accessToken}`;

    const res = await fetch(url);
    const data = await res.json();

    const route = data.routes[0].geometry.coordinates;
    const durationMin = Math.round(data.routes[0].duration / 60);

    // Adiciona linha da rota
    map.addSource("route", {
        type: "geojson",
        data: {
            type: "Feature",
            geometry: { type: "LineString", coordinates: route }
        }
    });

    map.addLayer({
        id: "route-line",
        type: "line",
        source: "route",
        paint: {
            "line-width": 5,
            "line-color": "#0A3D62"   // Azul Uber
        }
    });

    // Marcadores
    new mapboxgl.Marker({ color: "black" }).setLngLat(origin).addTo(map);
    new mapboxgl.Marker({ color: "black" }).setLngLat(dest).addTo(map);

    // Popup modelo Uber (somente destino)
    new mapboxgl.Popup({ offset: 25, closeButton: false })
        .setLngLat(dest)
        .setHTML(`
            <div class="uber-popup">
                <div class="uber-time">${durationMin} min</div>
                <div class="uber-address">Destino selecionado</div>
            </div>
        `)
        .addTo(map);

    // Ajustar zoom aos limites da rota
    const bounds = new mapboxgl.LngLatBounds();
    route.forEach(p => bounds.extend(p));
    map.fitBounds(bounds, { padding: 60 });
}

map.on("load", drawRoute);

</script>
</body>
</html>
